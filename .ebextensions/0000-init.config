# File name: 0000-init.config
# Purpose: Init the environment for the eMind EB extensions procedures
# Authors: Hadar Abraham

packages:
  yum:
    dos2unix: []

option_settings:
  - namespace: aws:elasticbeanstalk:application:environment
    option_name: SECRET_KEY
    value: ^G*PGmB8hQU6Ukg
  - namespace: aws:elasticbeanstalk:application:environment
    option_name: DATABASE_URL
    value: mysql://test:test123456@aa9rd3551k5bb4.caxythh1h96e.us-east-1.rds.amazonaws.com:3306/ebdb
  - namespace: aws:elasticbeanstalk:application:environment
    option_name: ALLOWED_HOSTS
    value: 127.0.0.1
  - namespace: aws:elasticbeanstalk:application:environment
    option_name: DEBUG
    value: True


container_commands:
  10-init-rm:

    # Remove the ebextensions local copy directory if exists
    command: "/bin/rm -rf /emind/ebextensions"
    ignoreErrors: false

  30-init-copy:
  
    # Create a sym-link from the EB working directory to /emind/ebextensions
    command: "cd ${PWD}/.ebextensions ; /bin/cp -pr . /emind/ebextensions"
    ignoreErrors: false

  40-init-unix2dos-chmodx-convert:

    # Convert any possibly shell scripts edited in Windows, to Unix format and permissions
    # unix2dos-chmodx-convert.sh will find any *.sh files and take care of them
    # but first we take care of itself here and then activate it
    command: 
      "/usr/bin/dos2unix /emind/ebextensions/init/* ;
       /bin/chmod a+x /emind/ebextensions/init/* ;
       /bin/bash /emind/ebextensions/init/unix2dos-chmodx-convert.sh"
    ignoreErrors: false
